<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="http://10.12.73.139:4000/wireless/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../../../assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2724382-16'); </script> <script type="text/javascript" src="../../../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../../../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Zigbee Multi-Sensor, commissioning App | Microchip MPLAB Harmony Wireless help</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Zigbee Multi-Sensor, commissioning App" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony 3 Wireless package" /> <meta property="og:description" content="Harmony 3 Wireless package" /> <link rel="canonical" href="readme.html" /> <meta property="og:url" content="http://10.12.73.139:4000/wireless/apps/multiprotocol/ble_zigbee_multiSensor_prov/readme.html" /> <meta property="og:site_name" content="Microchip MPLAB Harmony Wireless help" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Zigbee Multi-Sensor, commissioning App" /> <script type="application/ld+json"> {"@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://10.12.73.139:4000/wireless/assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"url":"http://10.12.73.139:4000/wireless/apps/multiprotocol/ble_zigbee_multiSensor_prov/readme.html","headline":"Zigbee Multi-Sensor, commissioning App","description":"Harmony 3 Wireless package","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="../../../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="readme.html#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="../../../index.html" class="nav-list-link">Harmony 3 Wireless Package</a></li><li class="nav-list-item active"><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../readme.html" class="nav-list-link">Examples applications</a><ul class="nav-list "><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../ble/building_blocks/readme.html" class="nav-list-link">BLE Building Blocks</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../ble/building_blocks/peripheral/readme.html" class="nav-list-link">Peripheral Building Blocks</a> </li><li class="nav-list-item "> <a href="../../ble/building_blocks/central/scan_ext_adv/readme.html" class="nav-list-link">BLE Extended Scan</a> </li><li class="nav-list-item "> <a href="../../ble/building_blocks/central/readme.html" class="nav-list-link">Central Building Blocks</a> </li><li class="nav-list-item "> <a href="../../ble/building_blocks/central/connection/readme.html" class="nav-list-link">BLE Connection(Central)</a> </li><li class="nav-list-item "> <a href="../../ble/building_blocks/central/profiles_services/readme.html" class="nav-list-link">BLE Profiles and Services (Central)</a> </li><li class="nav-list-item "> <a href="../../ble/building_blocks/central/profiles_services/trp_uart/readme.html" class="nav-list-link">Central Transparent UART</a> </li><li class="nav-list-item "> <a href="../../ble/building_blocks/central/profiles_services/ml_trp_uart/readme.html" class="nav-list-link">Multi Transparent UART</a> </li><li class="nav-list-item "> <a href="../../ble/building_blocks/chip_peripherals/uart/readme.html" class="nav-list-link">UART Demo</a> </li><li class="nav-list-item "> <a href="../../ble/building_blocks/central/freertos_ble_stack_init_central.html" class="nav-list-link">Freetos Stack Init</a> </li><li class="nav-list-item "> <a href="../../ble/building_blocks/peripheral/legacy_adv_sleep/readme.html" class="nav-list-link">Legacy Advertisement</a> </li><li class="nav-list-item "> <a href="../../ble/building_blocks/central/legacy_scan/readme.html" class="nav-list-link">Legacy Scan</a> </li><li class="nav-list-item "> <a href="../../ble/building_blocks/peripheral/connection/readme.html" class="nav-list-link">Peripheral Connection</a> </li><li class="nav-list-item "> <a href="../../ble/building_blocks/peripheral/ext_adv/readme.html" class="nav-list-link">Extended Advertisement</a> </li><li class="nav-list-item "> <a href="../../ble/building_blocks/peripheral/profiles_services/readme.html" class="nav-list-link">Profile and Services</a> </li><li class="nav-list-item "> <a href="../../ble/building_blocks/peripheral/profiles_services/trp_uart/readme.html" class="nav-list-link">Proprietary UART Service</a> </li><li class="nav-list-item "> <a href="../../ble/building_blocks/peripheral/profiles_services/custom_service/readme.html" class="nav-list-link">Custom Service</a> </li></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../ble/advanced_applications/readme.html" class="nav-list-link">BLE Advance Applications</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../ble/advanced_applications/ble_uart_demo/readme.html" class="nav-list-link">BLE UART Demo</a> </li><li class="nav-list-item "> <a href="../../ble/advanced_applications/ble_sensor_app/readme.html" class="nav-list-link">BLE Sensor DEMO</a> </li><li class="nav-list-item "> <a href="../../ble/advanced_applications/ble_sensor_app/protocol.html" class="nav-list-link">BLE Sensor (Protocol Exchange)</a> </li></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../zigbee/readme.html" class="nav-list-link">Zigbee</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../zigbee/zigbee_multisensor/readme.html" class="nav-list-link">Zigbee Multi-Sensor Low Power</a> </li><li class="nav-list-item "> <a href="../../zigbee/running_demo.html" class="nav-list-link">Zigbee Combined Interface Demo</a> </li><li class="nav-list-item "> <a href="../../zigbee/zigbee_commissioning.html" class="nav-list-link">Zigbee Commissioning Procedure</a> </li><li class="nav-list-item "> <a href="../../zigbee/zigbee_greenpower.html" class="nav-list-link">Zigbee Green Power</a> </li><li class="nav-list-item "> <a href="../../zigbee/zigbee_project_generation.html" class="nav-list-link">Zigbee Project Creation App</a> </li><li class="nav-list-item "> <a href="../../zigbee/zigbee_security_model.html" class="nav-list-link">Zigbee Network Security</a> </li></ul></li><li class="nav-list-item active"><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../readme.html" class="nav-list-link">Multiprotocol</a><ul class="nav-list"><li class="nav-list-item "> <a href="../ble_zigbee_basic/readme.html" class="nav-list-link">BLE+ZIGBEE Application</a> </li><li class="nav-list-item "> <a href="../ble_zigbee_light_prov/readme.html" class="nav-list-link">Multiprotocol Demo App</a> </li><li class="nav-list-item active"> <a href="readme.html" class="nav-list-link active">Zigbee Multi-Sensor, commissioning App</a> </li><li class="nav-list-item "> <a href="../ble_zigbee_light_prov/protocol.html" class="nav-list-link">Multiprotocol Protocol</a> </li></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../docs/readme.html" class="nav-list-link">User Docs</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../zigbee/consoleCommands.html" class="nav-list-link">Serial Console Commands</a> </li><li class="nav-list-item "> <a href="../../docs/lowpower.html" class="nav-list-link">Low Power</a> </li><li class="nav-list-item "> <a href="../../docs/user_action.html" class="nav-list-link">User Action</a> </li><li class="nav-list-item "> <a href="../../docs/generate_code.html" class="nav-list-link">Harmony 3 Code Generation</a> </li><li class="nav-list-item "> <a href="../../docs/creating_new_mplabx_harmony_project.html" class="nav-list-link">Generating New Harmony Code</a> </li><li class="nav-list-item "> <a href="../../docs/pic32cx_bz2_wbz45x_sdk_setup.html" class="nav-list-link">SDK Setup</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../release_notes.html" class="nav-list-link">Release notes</a><ul class="nav-list "><li class="nav-list-item "><a href="../../ble/advanced_applications/ble_uart_demo/release_notes.html" class="nav-list-link">BLE UART Demo</a></li><li class="nav-list-item "><a href="../../ble/advanced_applications/ble_sensor_app/release_notes.html" class="nav-list-link">BLE Sensor Release notes</a></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../ble/building_blocks/chip_peripherals/uart/release_notes.html" class="nav-list-link">UART Hello World</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../ble/building_blocks/peripheral/legacy_adv_sleep/release_notes.html" class="nav-list-link">BLE Legacy Adv</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../ble/building_blocks/peripheral/ext_adv/release_notes.html" class="nav-list-link">BLE Extended Advertising</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../ble/building_blocks/peripheral/connection/release_notes.html" class="nav-list-link">BLE Connection (Peripheral)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../ble/building_blocks/peripheral/profiles_services/custom_service/release_notes.html" class="nav-list-link">BLE Tranparent UART (Peirpheral)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../ble/building_blocks/peripheral/profiles_services/trp_uart/release_notes.html" class="nav-list-link">BLE Tranparent UART (Peirpheral)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../ble/building_blocks/central/connection/release_notes.html" class="nav-list-link">BLE Connection (Central)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../ble/building_blocks/central/legacy_scan/release_notes.html" class="nav-list-link">BLE Legacy Scan</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../ble/building_blocks/central/profiles_services/ml_trp_uart/release_notes.html" class="nav-list-link">BLE Multilink Transparent UART(Central)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="readme.html#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../ble/building_blocks/central/profiles_services/trp_uart/release_notes.html" class="nav-list-link">BLE Transparent UART(Central)</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="../../ble/building_blocks/central/scan_ext_adv/release_notes.html" class="nav-list-link">BLE Scan Extended Advertising</a></li><li class="nav-list-item "><a href="../../zigbee/zigbee_combined_interface/release_notes.html" class="nav-list-link">Zigbee Combined Interface App</a></li><li class="nav-list-item "><a href="../../zigbee/zigbee_lights/release_notes.html" class="nav-list-link">Zigbee Extended Lights App</a></li><li class="nav-list-item "><a href="../../zigbee/zigbee_multisensor/release_notes.html" class="nav-list-link">Zigbee Multi-Sensor Device Low Power</a></li><li class="nav-list-item "><a href="../ble_zigbee_light_prov/release_notes.html" class="nav-list-link">Zigbee Multiprotocol Lights Prov App</a></li><li class="nav-list-item "><a href="release_notes.html" class="nav-list-link">Zigbee Multi-Sensor and commissioning</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Microchip MPLAB Harmony Wireless help" aria-label="Search Microchip MPLAB Harmony Wireless help" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://support.microchip.com" class="site-button" > Obtain Support from Microchip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="../../readme.html">Examples applications</a></li> <li class="breadcrumb-nav-list-item"><a href="../readme.html">Multiprotocol</a></li> <li class="breadcrumb-nav-list-item"><span>Zigbee Multi-Sensor, commissioning App</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><a href="https://www.microchip.com"><img src="https://www.microchip.com/ResourcePackages/Microchip/assets/dist/images/logo.png" alt="MCHP" /></a></p> <h1 id="pic32cx-bz2wbz45-ble-zigbee-provisioning-low-power-application-demo-zigbee-multi-sensor-and-zigbee-commissioning-through-ble"> <a href="readme.html#pic32cx-bz2wbz45-ble-zigbee-provisioning-low-power-application-demo-zigbee-multi-sensor-and-zigbee-commissioning-through-ble" aria-labelledby="pic32cx-bz2wbz45-ble-zigbee-provisioning-low-power-application-demo-zigbee-multi-sensor-and-zigbee-commissioning-through-ble" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> PIC32CX-BZ2/WBZ45 BLE ZigBee Provisioning Low Power Application Demo: Zigbee Multi-Sensor and Zigbee commissioning through BLE </h1> <p>This tutorial will help users to create a low power enabled multiprotocol (BLE+ZIGBEE) example project from Microchip H3 project generator framework. The step by step procedure will help the user to generate a Zigbee Multi-Sensor application and commission the Multi-Sensor to a Zigbee network through BLE from scratch.</p> <h2 id="hardware-required"> <a href="readme.html#hardware-required" aria-labelledby="hardware-required" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Hardware Required </h2> <div class="table-wrapper"><table> <thead> <tr> <th><strong>Tool</strong></th> <th><strong>Qty</strong></th> </tr> </thead> <tbody> <tr> <td>WBZ451 Curiosity Board</td> <td>1</td> </tr> <tr> <td>Micro USB cable</td> <td>1</td> </tr> <tr> <td>Android/iOS Mobile</td> <td>1</td> </tr> </tbody> </table></div> <h2 id="sdk-setup"> <a href="readme.html#sdk-setup" aria-labelledby="sdk-setup" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SDK Setup </h2> <p><a href="../../docs/pic32cx_bz2_wbz45x_sdk_setup.html">SDK Setup</a></p> <h2 id="smartphone-app"> <a href="readme.html#smartphone-app" aria-labelledby="smartphone-app" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Smartphone App </h2> <p>Microchip Bluetooth Data (MBD) iOS/Android app available in stores</p> <h2 id="demo-description"> <a href="readme.html#demo-description" aria-labelledby="demo-description" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Demo Description </h2> <p>This application demonstrate the Zigbee Multi-Sensor end device joining to Zigbee Coordinator (Combined Interface, The thirdparty gateway’s like Amazon Echo plus can also be used instead of CI.) by receiving the commissioning parameters from user using a mobile phone through BLE Link. The mobile application uses Microchip Proprietary Transparent Service to send and receive data PIC32CX-BZ2/WBZ45 device.</p> <div style="text-align:center"><img src="assets/Ble_zigbee_link.jpg" /></div> <p>The BLE provisioner in the MBD App (available in Google Play Store and Apple Store) is utilized to demo the provisioning functionality.</p> <div style="text-align:center"><img src="assets/mbdApp_Home.jpg" /></div> <h2 id="developing-this-application-from-scratch-using-harmony-3"> <a href="readme.html#developing-this-application-from-scratch-using-harmony-3" aria-labelledby="developing-this-application-from-scratch-using-harmony-3" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developing this Application from scratch using Harmony 3 </h2> <p>The following steps will help to understand the PIC32CXBZ2 device ZIGBEE and BLE stack programming structure. Ensure that wireless_system_pic32cxbz2_wbz45 repo is checked out from MPLAB Harmony 3 Content Manager. We recommend to follow the steps.</p> <h3 id="pull-in-h3-components"> <a href="readme.html#pull-in-h3-components" aria-labelledby="pull-in-h3-components" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pull-in H3 Components </h3> <ol> <li> <p>Create a new MPLAB Harmony 3 Project – <a href="../../docs/creating_new_mplabx_harmony_project.html">link</a> for instructions</p> </li> <li> <p>Open MPLABx Harmony 3 Configurator. The Wireless System Service components will be displayed in available components. Select BLE ZIGBEE PROVISIONING from Available Components –&gt; Wireless –&gt; System Services as shown in the below figure.</p> </li> </ol> <div style="text-align:center"><img src="assets/Wireless_System_Service_active_components.jpg" /></div> <ol> <li>Drag BLE ZIGBEE PROVISIONING component from available components to project graph area as shown in below figure. Accept Dependencies or satisfiers, select “Yes”.</li> </ol> <div style="text-align:center"><img src="assets/BZ_Prov_project_Graph.jpg" /></div> <ol> <li>To add the Zigbee Device into the project, right click on the Zigbee Device in BLE ZIGBEE PROVISIONING component as shown in below figure. Click on the satisfiers tab and select the required ZigBee Device.</li> </ol> <div style="text-align:center"><img src="assets/zigbee_device_selection.jpg" /></div> <ol> <li> <p>Accept Dependencies or satisfiers, select “Yes”</p> </li> <li> <p>Click on Multi Sensor (ZIGBEE_MULTI_SENSOR) to add Multi-Sensor Zigbee device into project as shown below.</p> </li> </ol> <div style="text-align:center"><img src="assets/BZ_Prov_MultiSensor.jpg" /></div> <ol> <li>Select the Multi Sensor Zigbee device component by click on the component in the project graph. Now the <em>Configuration Options</em> tab will list the Configurations for the selected Zigbee device. Ensure that the <em>Manual Configuration</em> is selected and <em>Network Formation Commissioning Enable</em> and <em>AUTOMATIC COMMISSIONING ON STARTUP</em> is deselected as shown in below figure.</li> </ol> <div style="text-align:center"><img src="assets/Zigbee_device_Configuration.jpg" /></div> <ol> <li> <p>Select the BLE Stack component by clicking on the component. In the Configuration Options tab, Expand Generic Access Profile (GAP) –&gt; Advertising and then expand Advertising Data and Scan Response Data.</p> </li> <li> <p>In <em>Advertising Data</em> menu, ensure that <em>Local Name</em> is deselected and selected in <em>Scan Response Data</em> –&gt; <em>Local Name</em>. In <em>Advertising Data</em> menu, ensure that <em>Service Data</em> is selected, <em>Service UUID</em> is selected as 0xFEDA and <em>Service Data</em> is set as 0xFF03 as shown in below figure.</p> </li> </ol> <div style="text-align:center"><img src="assets/BLE_Adv_MBD_app.jpg" /></div> <p><strong>Note</strong>:</p> <ul> <li>0xFEDA is a 16-bit Service UUID which is purchased by Microchip from Bluetooth SIG.</li> <li>In order to list the device while scanning in Microchip Bluetooth Data (MBD) mobile application, the device should advertise with Service UUID as 0xFEDA and Service Data as 0xFF03.</li> </ul> <h3 id="low-power-configuration"> <a href="readme.html#low-power-configuration" aria-labelledby="low-power-configuration" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Low power Configuration </h3> <ol> <li>Enable Sleep Mode in BLE stack H3 component configuration, after enabling this dependent component like RTC (Timer source during sleep) will be requested to be enabled</li> </ol> <div style="text-align:center"><img src="assets/ble_sleep_mode.jpg" /></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>For Zigbee applications the System Sleep mode is only enabled when using the following device types - Multisensor, Intruder Alarm System and Color Scene controller as per the Zigbee End Device Spec. There is no separate configuration that a user has to select to enable the System Sleep like for BLE Sleep
</code></pre></div></div> <ol> <li>Upon enabling sleep mode, FreeRTOS related settings will be set automatically. <ul> <li>Tick Mode will be set to Tickless_Idle</li> <li>Expected idle time before sleep will be set to 5 (ms)</li> <li>Tick Hook will be enabled (For user to add any custom code needed to be executed within each tick interrupt)</li> <li>RTC peripheral library will be added and configured</li> </ul> <div style="text-align:center"><img src="assets/ble_sleep_freertos.jpg" /></div> <p><strong>Note:</strong> RTC counter should not be reset (RTC_Timer32CounterSet()) arbitrarily when the system is running</p> </li> <li>RTC clock source should be set manually, there are 4 options to choose from <ul> <li>FRC (±1% offset)</li> <li>LPRC ( with larger offset, &lt; ±5%)</li> <li>POSC &lt;- Candidate of the clock source (better clock accuracy)</li> <li>SOSC &lt;- Candidate of the clock source (better clock accuracy)</li> </ul> <p>Users can select POSC or SOSC as the RTC clock source. Choosing FRC and LPRC as clock sources for RTC will impact BLE connection stability. In this example SOSC is configured as RTC clock source.</p> </li> <li>In Harmony 3 configurator, Click “Tools” select “Clock Configuration” <div style="text-align:center"><img src="assets/Tools_Clock_selection.jpg" /></div> </li> <li>In Clock Diagram, <ul> <li>Enable Secondary Oscillator (SOSC) by setting <code class="language-plaintext highlighter-rouge">SOSCEN</code> to <code class="language-plaintext highlighter-rouge">ON</code></li> <li>Select <code class="language-plaintext highlighter-rouge">SOSC</code> as clock source for <code class="language-plaintext highlighter-rouge">VBKP_32KCSEL</code> and set <code class="language-plaintext highlighter-rouge">LPCLK_MOD</code> to <code class="language-plaintext highlighter-rouge">DIV_1_024</code> as hown in below below.</li> </ul> <div style="text-align:center"><img src="assets/ClockDiagram.jpg" /></div> <ul> <li>It is recommended to use 48MHz as SYS_CLOCK for better power savings. This can be configured by setting SPLLPOSTDIV1 to 2 as shown below.</li> </ul> <div style="text-align:center"><img src="assets/sys_clock.jpg" /></div> <ul> <li>Ensure that JTAG Enable is disabled by clearing the JTAGEN bit in CFGCON0 (Configuration Control Register 0) as shown below.<br /> <code class="language-plaintext highlighter-rouge">CFG_REGS-&gt;CFG_CFGCON0CLR = CFG_CFGCON0_JTAGEN_Msk;</code> <strong>Note:</strong> This is done in <code class="language-plaintext highlighter-rouge">APP_Prov_TRPS_Init()</code></li> </ul> </li> <li>All Unused pins in the application needs to be set in input mode and the pulldown should be enabled for these pins. This can be configured through pin configuration in Harmony3 Configurator as shown below. <div style="text-align:center"><img src="assets/lowpower_pin_config.jpg" /></div> </li> </ol> <h3 id="ble-zigbee-provisioning-addition"> <a href="readme.html#ble-zigbee-provisioning-addition" aria-labelledby="ble-zigbee-provisioning-addition" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> BLE Zigbee Provisioning addition </h3> <ol> <li> <p>Open app.c file and include the header file app_prov.h as shown in below figure.</p> <p><code class="language-plaintext highlighter-rouge">#include "app_prov/app_prov.h"</code></p> </li> </ol> <div style="text-align:center"><img src="assets/app_c_include_header.jpg" /></div> <ol> <li> <p>In app.c, Add the following code after APP_BleStackInit() in APP_Tasks function.</p> <p><code class="language-plaintext highlighter-rouge">APP_Prov_TRPS_Init();</code></p> <div style="text-align:center"><img src="assets/app_c_app_task.jpg" /></div> </li> <li> <p>Open app_ble_handler.c file located in app_ble project folder. In APP_BleGapEvtHandler() function, add the below code as shown in figure.</p> <p><code class="language-plaintext highlighter-rouge">extern void BZ_Prov_BleGapEvtHandler(BLE_GAP_Event_T *p_event);</code><br /> <code class="language-plaintext highlighter-rouge">BZ_Prov_BleGapEvtHandler(p_event);</code></p> <div style="text-align:center"><img src="assets/app_ble_handler.jpg" /></div> </li> <li> <p>Open app_trsps_handler.c file. In APP_TrspsEvtHandler() function, add the below code as shown in figure.</p> <p><code class="language-plaintext highlighter-rouge">extern void APP_TRPS_EventHandler(BLE_TRSPS_Event_T *p_event);</code><br /> <code class="language-plaintext highlighter-rouge">APP_TRPS_EventHandler(p_event);</code></p> <div style="text-align:center"><img src="assets/app_trps_event_handler.jpg" /></div> </li> <li> <p>Open app_zigbee_handler.c file located in app_zigbee project folder. In Zigbee_Event_Handler() function, add the below code as shown in figure.</p> <p><code class="language-plaintext highlighter-rouge">extern void BZ_Prov_Zigbee_Event_Handler(APP_Zigbee_Event_t event);</code><br /> <code class="language-plaintext highlighter-rouge">BZ_Prov_Zigbee_Event_Handler(event);</code></p> <div style="text-align:center"><img src="assets/app_zigbee_handler.jpg" /></div> </li> <li> <p>Open app_user_edits.c file. Comment out or remove the #error line. Update the freertos_hooks.c as mentioned in app_user_edits.c file</p> </li> <li> <p>Compile and Run the project in WBZ45x device.</p> </li> </ol> <h3 id="demo-steps-commissioning"> <a href="readme.html#demo-steps-commissioning" aria-labelledby="demo-steps-commissioning" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Demo Steps: commissioning </h3> <ol> <li>To Commission the Zigbee Multi-Sensor device, follow the step mentioned <a href="../ble_zigbee_light_prov/readme.html#demo-steps-commissioning">here</a></li> </ol> <h3 id="protocol-exchange"> <a href="readme.html#protocol-exchange" aria-labelledby="protocol-exchange" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Protocol Exchange </h3> <ol> <li>The communication protocol exchange between BLE Provisioner mobile app and WBZ451 module (BLE peripheral) is explained <a href="../ble_zigbee_light_prov/protocol.html">here</a></li> </ol> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0"><img src='https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png' /><br />Copyright &copy; 2020 Microchip Technology.</p> <!-- <p class="text-small text-grey-dk-000 mb-0"><img src='http://10.12.73.139:4000/wireless/assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2021 Microchip Technology.</p> --> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
